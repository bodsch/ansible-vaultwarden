[Unit]
Description             = Vaultwarden API server
Documentation           = https://github.com/dani-garcia/vaultwarden
After                   = network.target

[Service]
Type                    = simple
User                    = vaultwarden
Group                   = vaultwarden
LimitNOFILE             = 1048576
UMask                   = 0077

ExecStart               = /usr/bin/vaultwarden
EnvironmentFile         = /etc/vaultwarden/config.env

CapabilityBoundingSet   = CAP_NET_BIND_SERVICE
AmbientCapabilities     = CAP_NET_BIND_SERVICE

LockPersonality         = true
MemoryDenyWriteExecute  = true
PrivateDevices          = true
PrivateTmp              = true
ProtectClock            = true
ProtectControlGroups    = true
ProtectHome             = true
ProtectHostname         = true
ProtectKernelLogs       = true
ProtectKernelModules    = true
ProtectKernelTunables   = true
ProtectSystem           = strict
RemoveIPC               = true
RestrictAddressFamilies = AF_UNIX AF_INET AF_INET6
RestrictNamespaces      = true
RestrictRealtime        = true
RestrictSUIDSGID        = true

NoNewPrivileges         = true

SystemCallFilter        = @system-service
SystemCallFilter        = ~@privileged @resources
SystemCallArchitectures = native

WorkingDirectory        = /var/lib/vaultwarden
ReadWriteDirectories    = /var/lib/vaultwarden
ReadWriteDirectories    = {{ vaultwarden_config.logging.log_file | dirname }}
ReadWriteDirectories    = /usr/share/vaultwarden/web-vault/

[Install]
WantedBy              = multi-user.target
